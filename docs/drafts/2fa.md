# Baseline practice: using 2FA when publishing

To avoid malicious use of stolen package registry tokens, it is advisable to enable two-factor authentication (2FA). When it is enabled every call to `npm publish` requires a unique one time password (OTP) to be entered.

To make sure that the code is a _second_ factor it should be generated by a human on an independent device. The secret seed of the OTP generator should be protected in such a way, that it cannot be obtained together with the registry token.

At the moment, the advice to use 2FA is at odds with advice to automate the testing and release processes, esp. with publishing automatically from Continuous Integration (CI) systems (e.g. Travis).

This document outlines possible solutions to bridge this gap with the goal of enabling easy setup of automated releases from CI, using 2FA (human approval), for individuals and for teams.

## Related docs

* [Publish guidelines (draft)](https://github.com/nodejs/package-maintenance/blob/master/docs/drafts/PUBLISH-GUIDELINES.md)
* [CI/CD guidelines (draft)](https://github.com/nodejs/package-maintenance/blob/master/docs/drafts/ci-cd-guidelines.md)
* [Testing guidelines (draft)](https://github.com/nodejs/package-maintenance/blob/master/docs/drafts/testing-guidelines.md)

Note: at the time of writing neither documents or gives advice on using two-factor authentication when publishing.

## Potential solutions

### Release manager

- Cons: 
    - complexity
    - compatibility
    - effort to build
    - maintenance

### Remote OTP

#### Approval via mobile 

POC: https://github.com/nearform/optic

- Cons: 
    - dependency on Firebase
    - needs a server

#### Entry via chatbot
 
POC: ask https://twitter.com/MarshallOfSound

- Cons: 
    - dependency on Slack
    - needs a server
    - needs the OTP to actually be typed out

#### SaaS

- Cons: 
    - none publicly available and free
    - trust

### Use remote decryption service

- Cons: 
    - requires setup

### Use GitHub releases / alternative registries for staging

- Cons: 
    - requires setup
    - requires a manual action
